# SubScene

SubScene æ˜¯ Unity DOTS ä¸­ç”¨äºç»„ç»‡ã€å­˜å‚¨å’Œæµå¼åŠ è½½ Entity æ•°æ®çš„ç‰¹æ®Šåœºæ™¯èµ„æºå•å…ƒã€‚

ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºï¼š
â€œGameObject æ—¶ä»£çš„ Prefab / Scene + DOTS çš„ Entity æ•°æ®æ‰“åŒ…å™¨ + çƒ­åŠ è½½å®¹å™¨â€

SubScene = DOTS çš„åœºæ™¯å•ä½ + å®ä½“æ•°æ®ç¼“å­˜

å®ƒæœ‰ä¸¤ä¸ªâ€œé˜¶æ®µâ€ï¼š

- ç¼–è¾‘å™¨ï¼ˆEditorï¼‰
  ä½ ç”¨ GameObject å’Œ MonoBehavior æ­åœºæ™¯
- æ„å»ºæ—¶ï¼ˆBakingï¼‰
  Unity ä¼šå°†å†…å®¹è½¬åŒ–ä¸º Entityï¼Œå¹¶æ‰“åŒ…ä¸º `.entities` æ–‡ä»¶

èµ„æºæ‰“åŒ…ï¼š
   - .entities æ–‡ä»¶
   - Baked Entity æ•°æ®
   - BlobAsset / ç»„ä»¶ / Buffer / Reference ç­‰

åŠ è½½æ§åˆ¶ï¼š

- å¯é€‰ AutoLoad
- æ”¯æŒå¼‚æ­¥åŠ è½½ / çƒ­å¸è½½

![image-20250328003213318](./image-20250328003213318.png)

## 4. å¦‚ä½•åœ¨è¿è¡Œæ—¶åŠ è½½/å¸è½½ SubSceneï¼Ÿ

Unity æä¾› `SceneSystem` æ¥åŠ¨æ€åŠ è½½ DOTS SubSceneã€‚

ç¤ºä¾‹ä»£ç ï¼š

```c#
var sceneSystem = World.DefaultGameObjectInjectionWorld.GetExistingSystemManaged<SceneSystem>();
var sceneGUID = new Unity.Entities.Hash128("ä½ çš„SubSceneGUID");

SceneSystem.LoadSceneAsync(sceneSystem.WorldUnmanaged, sceneGUID, new SceneSystem.LoadParameters
{
    AutoLoad = true
});
```

 å¸è½½ï¼š

```c#
SceneSystem.UnloadScene(sceneGUID);
```

ä½ å¯ä»¥ç›‘å¬ SubScene åŠ è½½çŠ¶æ€ï¼š

```c#
SceneSystem.IsSceneLoaded(sceneGUID);
```

**SubScene æ”¯æŒçš„åŠ è½½æ¨¡å¼**

| æ¨¡å¼        | æè¿°                                      |
| ----------- | ----------------------------------------- |
| `AutoLoad`  | Unity ä¼šåœ¨åœºæ™¯åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½å®ƒ            |
| `Manual`    | ä½ æ‰‹åŠ¨è°ƒç”¨ API åŠ è½½                       |
| `Streaming` | ç»“åˆ Hybrid Renderer æŒ‰è§†é‡åŠ è½½ï¼ˆéœ€é…ç½®ï¼‰ |

------

## ğŸ§  SubScene çš„å®é™…è¿è¡Œæœºåˆ¶ï¼š

- æ¯ä¸ª SubScene å†…çš„ Entity ä¼šè¢«æ”¾è¿›å½“å‰ `World`
- SubScene ä¼šç”Ÿæˆä¸€ä¸ªé¡¶çº§â€œè™šæ‹Ÿ Scene Entityâ€ï¼ŒåŒ…å«æ‰€æœ‰å­å®ä½“å¼•ç”¨
- ä½ å¯ä»¥é€šè¿‡ `SceneTag` æŸ¥è¯¢æ¥è‡ªå“ªä¸ª SubScene çš„å®ä½“

```c#
Entities.WithAll<SceneTag>().ForEach(...);
```

------

## âœ… ä¸ GameObject åœºæ™¯çš„åŒºåˆ«

| ç‰¹æ€§       | GameObject Scene       | DOTS SubScene                   |
| ---------- | ---------------------- | ------------------------------- |
| ç»“æ„       | Mono + Script          | Entity + IComponentData         |
| å­˜å‚¨       | Hierarchy + Prefab     | Packed Entityï¼ˆ.entities æ–‡ä»¶ï¼‰ |
| è¿è¡Œæ—¶æ€§èƒ½ | æ…¢ï¼ˆå±‚çº§éå† + GCï¼‰    | å¿«ï¼ˆçº¿æ€§å†…å­˜ + Burstï¼‰          |
| åŠ è½½æ–¹å¼   | SceneManager.LoadScene | SceneSystem.LoadSceneAsync      |
| éƒ¨ç½²æ–¹å¼   | æ•´åŒ…                   | æ”¯æŒçƒ­æ›´ï¼ˆåªæ›´æ–° .entitiesï¼‰    |

------

## âœ… SubScene å’Œ World çš„å…³ç³»

- æ¯ä¸ª SubScene åŠ è½½æ—¶ï¼Œä¼šå°†å…¶å®ä½“å†…å®¹åŠ è½½è¿›æŒ‡å®šçš„ `World`
- é»˜è®¤æ˜¯ `DefaultGameObjectInjectionWorld`
- ä½ ä¹Ÿå¯ä»¥ç”¨ `SceneSystem.LoadSceneAsync(world, ...)` æŒ‡å®šåŠ è½½åˆ°æŸä¸ª World

è¿™æ ·ä½ å°±å¯ä»¥ï¼š

- æŠŠä¸åŒ SubScene åŠ è½½è¿›ä¸åŒ Worldï¼ˆåšå¹¶è¡Œæ¨¡æ‹Ÿï¼‰
- åŠ¨æ€å¸è½½åœºæ™¯æ•°æ®ï¼Œä¿æŒ World å†…å­˜å¹²å‡€

------

## âœ… å¸¸è§åº”ç”¨åœºæ™¯

| åœºæ™¯         | SubScene ç”¨æ³•                            |
| ------------ | ---------------------------------------- |
| å¼€æ”¾ä¸–ç•Œ     | æ¯å—åœ°å›¾æ‹†æˆ SubSceneï¼ŒæŒ‰éœ€åŠ è½½          |
| æ€ªç‰©åˆ·æ€ª     | æ€ªç‰©é¢„åˆ¶ä½“åšæˆ SubSceneï¼Œç”Ÿæˆæ—¶åŠ è½½      |
| è§’è‰²æ•°æ®çƒ­æ›´ | æ¯ä¸ªè§’è‰²é€»è¾‘æ‰“æˆç‹¬ç«‹ SubScene            |
| åœºæ™¯åˆ‡æ¢è¿‡æ¸¡ | A Scene å¸è½½æ—¶å»¶è¿Ÿé‡Šæ”¾ SubScene æ•°æ®     |
| æ‹†åŒ…åŠ è½½èµ„æº | .entities æ–‡ä»¶æ”¾è¿› Addressables æŒ‰éœ€åŠ è½½ |