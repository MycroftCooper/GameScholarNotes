# 如何实现描边效果

## 方案一：法线外扩

### 原理

利用一个特殊的描边材质，对模型进行膨胀（顶点沿法线扩张），然后以描边颜色渲染在原始模型之后。

1. 在渲染前，用一个 Pass 渲染扩大版模型（用黑色或指定描边色）。
2. 这个 Pass 使用背面剔除（Cull Front）+ 顶点法线外扩。
3. 正常再渲染原始模型。

### 优缺点

**优点：**

- 不依赖摄像机后处理，单独物体即可控制。
- 控制自由度高：可以动态调整颜色、粗细等。
- 支持透明物体、支持可选描边。

**缺点：**

- 每个被描边对象会多一次 Draw Call（一般是两个 Pass）。
- 对模型法线要求较高，低模容易变形。
- 不适合大量对象同时描边，性能有一定负担。
- 会存在转角损失

### 转角损失

当我们对模型的每个顶点沿着其 **法线方向外扩** 时，会造成以下现象：

- **平面区域：**
  顶点法线基本一致，整体扩张后形成稳定的轮廓。
- **锐角或转角处（尤其是90°以下）：**
  相邻三角面之间法线方向差异大。
  拓展后的顶点彼此“张开”，**转角处就会出现缺口**或“齿状断裂”描边。

**视觉表现：**

- 有时在角色的手肘、膝盖、肩膀、尖锐配件位置出现“缺线”“锯齿缺口”。
- **描边不连续，破坏美观。**

**解决方案：**

**方案 A：法线平滑**

- 尽量让模型法线平滑过渡（尤其是硬边过多时）。
- 使用模型软件（如 Blender）开启“Auto Smooth”或手动合并法线。
- 缺点是：可能导致模型阴影表现不真实。

**方案 B：切线空间替代法线扩张**

- 使用切线空间中的**屏幕空间扩张**，不是沿模型法线扩张。
- 这样能更稳定地控制描边形状，尤其在复杂几何时更好看。
- 但实现上复杂一些，不适合初级开发者。

### 适用场景：

- RPG 中角色被选中时高亮。
- 精细控制物体是否描边，如交互对象提示。
- 对透明物体或特殊形状物体有更好支持。

## 方案二：片元模拟+边缘检测（片元阶段）

### 原理

在物体自身的材质 Shader 中，于**片元阶段**模拟描边效果：

- 对当前像素（Fragment）进行多个方向的偏移采样（通常在屏幕 UV 空间下）。
- 检测当前像素颜色或深度、法线与周围像素的差异。
- 若差异超过阈值，则判定为边缘，渲染为描边颜色。

也可以直接偏移片元的输出位置，模拟出“描边外壳”的外扩感。

### 优缺点

**优点：**

- 可以逐物体控制，灵活开关。
- 描边连续性更好，不受顶点稀疏程度限制。
- 效果柔和，能模拟“卡通线”、“发光描边”等特殊风格。

**缺点：**

- 每个像素都进行多次采样，性能较高。
- 对屏幕分辨率依赖大，需注意动态分辨率下的问题。
- 不易处理遮挡关系、透明物体等复杂情况。

### 适用场景：

- 对描边视觉要求较高的角色或主角轮廓。
- 卡通渲染、发光描边、二次元风格项目。
- 可以承受一定 GPU 开销的高质量项目。

## 方案三：图像后处理+边缘检测（屏幕空间）

### 原理

使用 **后处理 Shader**，在图像渲染完后通过深度图、法线图等信息，检测边缘并绘制描边。

- 先渲染深度图和法线图。
- 使用一个后处理材质，在屏幕空间比较相邻像素的深度/法线差异，检测边缘。
- 将边缘绘制为描边颜色。

### 优缺点

**优点：**

- 不需要修改模型或材质，适用于大量物体统一描边。
- 可以批量描边多个物体，效果一致。
- 性能较高，尤其适合静态场景或大量对象描边。

**缺点：**

- 难以对个别物体精确控制描边（例如只描一个角色的轮廓）。
- 对透明物体支持差，容易出现错误的描边。
- 依赖摄像机后处理，不能脱离摄像机使用。

### 适用场景：

- 需要对多个物体统一做描边，比如选中高亮、大地图轮廓。
- 游戏中有大量单位需要快速显示选中状态。

# **总结对比表**

| 技术方案           | 所在阶段   | 原理                          | 优点                         | 缺点                                     | 适用场景                             |
| ------------------ | ---------- | ----------------------------- | ---------------------------- | ---------------------------------------- | ------------------------------------ |
| 法线外扩           | 顶点阶段   | 顶点沿模型/切线空间扩张       | 实现简单、灵活控制、支持透明 | 转角缺失、对模型要求高、多一次 Pass      | 单物体描边、高亮提示、低模卡通角色   |
| 片元模拟边缘检测   | 片元阶段   | 屏幕空间采样/颜色或深度差异   | 描边精致、效果柔和、风格化强 | 片元操作开销大、分辨率敏感、不易处理遮挡 | 二次元风格、高质量描边、特殊视觉表现 |
| 图像后处理边缘检测 | 后处理阶段 | 基于法线/深度图的全局边缘检测 | 性能高、易统一、适合批量对象 | 缺乏个体控制、透明支持差、依赖摄像机     | 大量单位描边、策略游戏、统一高亮轮廓 |